{% extends 'tasks/base.html' %}
{% load static %}
{% block content %}
<div class="header">
    <link rel="stylesheet" href="{% static 'tasks/css/task_list.css' %}" />
    <h1><img src="{% static 'tasks/images/pencil.png' %}" alt="Logo"  style="width: 30px; height: 30px;"> Feladataim</h1>
    <div style="display: flex; gap: 10px;">
        <a href="{% url 'task_analytics' %}" class="btn" style="background: #27ae60;"><img src="{% static 'tasks/images/increase.png' %}" alt="Logo"  style="width: 20px; height: 20px;"> ElemzÃ©sek</a>
        <a href="{% url 'task_create' %}" class="btn">+ Ãšj feladat</a>
    </div>
</div>

<div class="filters">
    <form method="get" style="display: flex; gap: 10px; margin: 0;">
        <select name="status" onchange="this.form.submit()">
            <option value="">Minden stÃ¡tusz</option>
            <option value="todo" {% if status_filter == 'todo' %}selected{% endif %}>TennivalÃ³</option>
            <option value="in_progress" {% if status_filter == 'in_progress' %}selected{% endif %}>Folyamatban</option>
            <option value="done" {% if status_filter == 'done' %}selected{% endif %}>KÃ©sz</option>
        </select>

        <select name="priority" onchange="this.form.submit()">
            <option value="">Minden prioritÃ¡s</option>
            <option value="low" {% if priority_filter == 'low' %}selected{% endif %}>Alacsony</option>
            <option value="medium" {% if priority_filter == 'medium' %}selected{% endif %}>KÃ¶zepes</option>
            <option value="high" {% if priority_filter == 'high' %}selected{% endif %}>Magas</option>
        </select>

        {% if status_filter or priority_filter %}
        <a href="{% url 'task_list' %}" class="btn btn-small">SzÅ±rÅ‘k tÃ¶rlÃ©se</a>
        {% endif %}
    </form>
</div>
{% if tasks %}
    {% for task in tasks %}
    <div class="task-card {% if task.status == 'done' %}done{% elif task.deadline_status == 'overdue' %}overdue{% else %}{{ task.priority }}{% endif %}">
        <div class="task-header">
            <h3 class="task-title {% if task.status == 'done' %}done{% endif %}">
                {{ task.title }}
            </h3>
        </div>

        <div class="task-meta">
            <span class="badge badge-status">{{ task.get_status_display }}</span>
            <span class="badge badge-priority {{ task.priority }}">{{ task.get_priority_display }}</span>
            
            {% if task.deadline %}
                {% if task.deadline_status == 'overdue' %}
                    <span class="deadline-badge deadline-overdue">
                        âš ï¸ LEJÃRT: {{ task.deadline|date:"Y.m.d H:i" }}
                    </span>
                {% elif task.deadline_status == 'soon' %}
                    <span class="deadline-badge deadline-soon">
                        â° Hamarosan lejÃ¡r: {{ task.deadline|date:"Y.m.d H:i" }}
                    </span>
                {% elif task.deadline_status == 'ok' %}
                    <span class="deadline-badge deadline-ok">
                        ğŸ“… HatÃ¡ridÅ‘: {{ task.deadline|date:"Y.m.d H:i" }}
                    </span>
                {% elif task.status == 'done' %}
                    <span class="deadline-badge" style="background: #95a5a6; color: white;">
                        âœ“ HatÃ¡ridÅ‘ volt: {{ task.deadline|date:"Y.m.d H:i" }}
                    </span>
                {% else %}
                    <span class="deadline-badge deadline-ok">
                        ğŸ“… {{ task.deadline|date:"Y.m.d H:i" }}
                    </span>
                {% endif %}
            {% endif %}
        </div>

        {% if task.description %}
        <div class="task-description">
            {{ task.description }}
        </div>
        {% endif %}

        <div class="task-actions">
            <form method="post" action="{% url 'task_toggle' task.pk %}" style="display: inline; margin: 0;">
                {% csrf_token %}
                {% if task.status == 'done' %}
                <button type="submit" class="btn btn-small">â†©ï¸ Ãšjra megnyitÃ¡s</button>
                {% else %}
                <button type="submit" class="btn btn-success btn-small">âœ“ KÃ©sz</button>
                {% endif %}
            </form>
            <a href="{% url 'task_update' task.pk %}" class="btn btn-small">âœï¸ SzerkesztÃ©s</a>
            <a href="{% url 'task_delete' task.pk %}" class="btn btn-danger btn-small">ğŸ—‘ï¸ TÃ¶rlÃ©s</a>
        </div>
    </div>
    {% endfor %}
{% else %}
    <div class="empty-state">
        <h2>ğŸ“­ Nincs mÃ©g feladatod!</h2>
        <p>Kezdj el dolgozni azzal, hogy lÃ©trehozol egy Ãºj feladatot.</p>
        <a href="{% url 'task_create' %}" class="btn" style="margin-top: 20px;">+ ElsÅ‘ feladat lÃ©trehozÃ¡sa</a>
    </div>
{% endif %}
{% endblock %}